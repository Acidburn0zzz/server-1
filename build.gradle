apply plugin: 'base'

evaluationDependsOnChildren()

def binPath = project.buildDir.toPath().resolve('bin')
def binDir = 'bin'
def docDir = 'doc'
def libDir = 'lib'

def binCommonPath = binPath.resolve('common')
def binLinuxPath = binPath.resolve('linux')

task distBinJar(type: Copy) {
    dependsOn subprojects.jar

    from project('hbox-server-core').jar
    from project.file('scripts/hboxd')
    into binCommonPath.resolve(binDir)
}

task distBinLib(type: Copy) {
    from subprojects.configurations.compile
    into binCommonPath.resolve(libDir)
}

task distBinDoc(type: Copy) {
    from project('hbox-api').file(docDir)
    into binCommonPath.resolve(docDir)
}

task distBinCommon {
    dependsOn distBinJar, distBinLib, distBinDoc
}

task distBinLinux(type: Copy) {
    dependsOn distBinCommon

    from project.file('scripts/hyperbox')
    from project.file('scripts/initd/hboxd.init')
    from binCommonPath.toString() // using a Path creates a Stack Overflow
    into binLinuxPath
}
